<script>
  const SALT = "soc-quiz-v1::diasik17";
  const EXPECTED_HASH = "REPLACE_WITH_HASH";

  function selected(name) {
    const el = document.querySelector("input[name='" + name + "']:checked");
    return el ? el.value : "";
  }

  async function sha256Hex(str) {
    const data = new TextEncoder().encode(str);
    const digest = await crypto.subtle.digest("SHA-256", data);
    return Array.from(new Uint8Array(digest)).map(b => b.toString(16).padStart(2, "0")).join("");
  }

  document.getElementById("check").addEventListener("click", async () => {
    const payload = {
      q1: selected("q1"),
      q2: selected("q2"),
      q3: selected("q3"),
      q4: selected("q4"),
      q5: selected("q5"),
    };

    Object.keys(payload).forEach((q) => {
      const n = q.replace("q", "");
      const card = document.querySelector(".card[data-q='" + n + "']");
      if (!payload[q]) {
        card.style.borderColor = "#f2c0c0";
        card.style.background = "#fffafa";
      }
    });

    if (Object.values(payload).some(v => !v)) return;

    const canonical =
      `q1=${payload.q1}|q2=${payload.q2}|q3=${payload.q3}|q4=${payload.q4}|q5=${payload.q5}`;
    const hash = await sha256Hex(SALT + "::" + canonical);

    const okAll = (hash === EXPECTED_HASH);

    document.querySelectorAll(".card").forEach(card => {
      card.style.borderColor = okAll ? "#bfe7c9" : "#f2c0c0";
      card.style.background = okAll ? "#fbfffc" : "#fffafa";
    });

    const resultEl = document.getElementById("result");
    resultEl.style.display = "block";
    resultEl.innerHTML =
      "<div><strong>Результат:</strong> " +
      (okAll ? "5 из 5 (100%)" : "есть ошибки") +
      "</div>" +
      "<div style='margin-top:8px;'>" +
      (okAll
        ? "<span class='good'>Отлично! Все ответы верные.</span>"
        : "<span class='bad'>Есть ошибки — проверь ответы и попробуй снова.</span>") +
      "</div>";
  });

  document.getElementById("reset").addEventListener("click", () => {
    const resultEl = document.getElementById("result");
    resultEl.style.display = "none";
    document.querySelectorAll(".card").forEach(card => {
      card.style.borderColor = "#e5e5e5";
      card.style.background = "#fff";
    });
  });
</script>
